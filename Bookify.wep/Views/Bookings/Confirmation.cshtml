@model Bookify.Domain.Entities.Booking

@{
    ViewData["Title"] = "Booking Confirmed";
    // safety: some fields might be null if not loaded - use ?. and null-coalesce
    var guestName = Model?.GidNavigation?.Fullname ?? "Guest";
    var guestPhone = Model?.GidNavigation?.Phone ?? "";
    var roomType = Model?.Room?.RoomType ?? "Room";
    var checkIn = Model?.CheckIn;
    var checkOut = Model?.CheckOut;
    var totalText = Model?.Room != null
        ? string.Format("{0:C}", Model.Room.Price * ((Model.CheckOut.ToDateTime(new TimeOnly(0, 0)) - Model.CheckIn.ToDateTime(new TimeOnly(0, 0))).Days))
        : "";
    var confirmationNumber = $"SEASIDE-{Model?.BookingId}";
}

@section Styles {
    <link rel="stylesheet" href="~/css/confirmation-styles.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet" />
}

<div class="confirmation-page-container container">
    <div class="confirmation-box">
        <div class="success-icon" aria-hidden="true">
            <i class="fas fa-check-circle fa-4x" title="Confirmed"></i>
        </div>

        <h1 class="confirmation-title">Your Booking is Confirmed</h1>
        <p class="confirmation-subtitle">Thank you for choosing Seaside Hotel — we look forward to hosting you.</p>

        <div class="summary-details">
            <div class="detail-line">
                <span class="label">Booking Number:</span>
                <span class="value ref-number">@confirmationNumber</span>
            </div>

            <div class="detail-line">
                <span class="label">Guest Name:</span>
                <span class="value">@guestName</span>
            </div>

            <div class="detail-line">
                <span class="label">Phone:</span>
                <span class="value">@guestPhone</span>
            </div>

            <div class="detail-line">
                <span class="label">Room Type:</span>
                <span class="value">@roomType</span>
            </div>

            <div class="detail-line">
                <span class="label">Check-in Date:</span>
                <span class="value">@((checkIn.HasValue) ? checkIn.Value.ToString("dd MMM yyyy") : "-")</span>
            </div>

            <div class="detail-line">
                <span class="label">Check-out Date:</span>
                <span class="value">@((checkOut.HasValue) ? checkOut.Value.ToString("dd MMM yyyy") : "-")</span>
            </div>

            <div class="detail-line">
                <span class="label">Nights of Stay:</span>
                <span class="value">@((Model != null) ? ((Model.CheckOut.ToDateTime(new TimeOnly(0, 0)) - Model.CheckIn.ToDateTime(new TimeOnly(0, 0))).Days) : 0)</span>
            </div>

            <div class="detail-line">
                <span class="label">Estimated Total Price:</span>
                <span class="value total-paid">@(!string.IsNullOrEmpty(totalText) ? totalText : "-")</span>
            </div>
        </div>

        <div class="next-steps">
            @if (!string.IsNullOrWhiteSpace(Model?.GidNavigation?.User?.Email))
            {
                <p>A confirmation message has been sent to <strong>@Model.GidNavigation.User.Email</strong>.</p>
            }
            else
            {
                <p>You will receive the booking confirmation in your email if you registered it during the booking.</p>
            }

            <div class="confirmation-actions" style="margin-top:16px; display:flex; gap:10px; flex-wrap:wrap;">
                <a asp-controller="Home" asp-action="Index" class="btn primary-btn back-home-btn">Back to Home</a>

                <a href="/Bookings/CustomerDetails/@Model.BookingId">View Booking Details</a>
                <button type="button" class="btn" id="print-receipt-btn" onclick="window.print();">Print Receipt</button>

                <a asp-controller="Bookings" asp-action="DownloadReceipt" asp-route-id="@Model.BookingId" class="btn" style="background:#f5f5f5;">Download Receipt (PDF)</a>
            </div>

            <p class="small-note" style="margin-top:12px; color:#666;">
                To cancel or modify your reservation, use the "View Booking Details" link, and if you have any questions, please contact the hotel.
            </p>
        </div>
    </div>
</div>

@* @section Scripts {
    <script>
        // small client-side polish: copy confirmation number to clipboard
        document.addEventListener('click', function (e) {
            if (e.target && e.target.id === 'copy-ref-btn') {
                const txt = document.querySelector('.ref-number')?.textContent;
                if (!txt) return;
                navigator.clipboard?.writeText(txt.trim()).then(function () {
                    alert('Booking number copied');
                });
            }
        });
    </script> *@

    <script src="~/js/nav.js"></script>
}